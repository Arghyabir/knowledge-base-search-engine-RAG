<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title>RAG KB Demo</title>
  </head>
  <body>
    <h2>Knowledge-base Search Engine (RAG) - Demo</h2>
    <div>
      <h3>Ingest Documents</h3>
      <input id="fileinput" type="file" multiple />
      <button onclick="upload()">Upload & Ingest</button>
      <div id="uploadres"></div>
    </div>
    <hr/>
    <div>
      <h3>Ask a Question</h3>
      <input id="query" type="text" style="width:60%"/>
      <input id="k" type="number" value="5" min="1" max="10"/>
      <button onclick="ask()">Ask</button>
      <pre id="answer"></pre>
    </div>
    <script>
      async function upload(){
        const files = document.getElementById('fileinput').files;
        if(files.length===0){ alert('select files'); return;}
        const fd = new FormData();
        for(let i=0;i<files.length;i++) fd.append('files', files[i]);
        const res = await fetch('/ingest', {method:'POST', body: fd});
        const j = await res.json();
        document.getElementById('uploadres').innerText = JSON.stringify(j,null,2);
      }
      async function ask(){
        const q = document.getElementById('query').value;
        const k = document.getElementById('k').value;
        const res = await fetch('/query', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({query:q,k:k})});
        const j = await res.json();
        document.getElementById('answer').innerText = JSON.stringify(j, null, 2);
      }
    </script>
  </body>
</html>
